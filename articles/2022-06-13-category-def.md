---
title: "圏の本質は合成だったんだ!"
emoji: "🙌"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["圏論"]
published: false
---

> しかし圏の本質は 合成 (composition) にある．
> 
> [1. 合成の本質｜プログラマのための圏論 (執筆中)](https://zenn.dev/taketo1024/books/850b20937af93b/viewer)

この言葉が理解できるように，参考記事にある圏の具体例を使いつつ，自分なりに説明をしてみます．

* [はじめての圏論 その第1歩：しりとりの圏 - 檜山正幸のキマイラ飼育記 (はてなBlog)](https://m-hiyama.hatenablog.com/entry/20060821/1156120185)
* [完全実装付きでもう一度お送りします、しりとりの圏 - 檜山正幸のキマイラ飼育記 (はてなBlog)](https://m-hiyama.hatenablog.com/entry/20090424/1240552575)
* [はじめての圏論 その第2歩：行列の圏 - 檜山正幸のキマイラ飼育記 (はてなBlog)](https://m-hiyama.hatenablog.com/entry/20060822/1156213781)
* [はじめての圏論 その第3歩：極端な圏達 - 檜山正幸のキマイラ飼育記 (はてなBlog)](https://m-hiyama.hatenablog.com/entry/20060823/1156300345)

---

# ひらがなの文字列

参考記事
* [はじめての圏論 その第1歩：しりとりの圏 - 檜山正幸のキマイラ飼育記 (はてなBlog)](https://m-hiyama.hatenablog.com/entry/20060821/1156120185)
* [完全実装付きでもう一度お送りします、しりとりの圏 - 檜山正幸のキマイラ飼育記 (はてなBlog)](https://m-hiyama.hatenablog.com/entry/20090424/1240552575)

`りんご`，`ご`，`ごりら`，`らっぱ`など，ひらがなの文字列がある．

このひらがなの文字列同士を**合成**するルールを決めよう．

## 例: 合成できる

例えば，次のように合成することができる．

* `りんご`と`ごりら`を合成すると，`りんごりら`になる．
* `ごりら`と`らっぱ`を合成すると，`ごりらっぱ`になる．

合成結果の`りんごりら`と`ごりらっぱ`も，`りんご`や`ごりら`と同じようにひらがなの文字列になった．
> `りんごりら`や`ごりらっぱ`という単語は存在しないが，ここで考えているのは**ひらがなの文字列**なので，単語でなくてもいい．

## 例: 合成できない
次に，ひらがなの文字列が合成できない場合も考える．例えば，

* `りんご`と`らっぱ`は合成できない．

## ✅合成のルール　その１
では，合成できる場合と，できない場合の違いをどのように決めようか．
`りんご`の最後の文字は`'ご'`で，`ごりら`の最初の文字も`'ご'`であった．
これを二つのひらがなの文字列が合成できる条件にしよう．

1. 前の文字列の最後の文字と，後ろの文字列の最初の文字が同じとき，前後の文字列を合成した文字列を作ることができる．

例では，`ごりら`の最後の文字と，`らっぱ`の最初の文字が，どちらも`'ら'`であったから，合成ができた．
`りんご`と`らっぱ`が合成できなかったのは，`りんご`の最後の文字が`'ご'`であるのに対し，`らっぱ`の最初の文字は，`'ら'`だったからだ．

## 例: 合成してさらに合成する
次に，先ほど合成したひらがなの文字列をさらに合成してみる．

* `りんごりら`と`らっぱ`を合成すると，`りんごりらっぱ`になる．
* `りんご`と`ごりらっぱ`を合成すると，`りんごりらっぱ`になる．

どちらも`りんごりらっぱ`という同じひらがなの文字列になった．

## ✅合成のルール　その２

`りんごりら`は，`りんご`と`ごりら`の合成で作られたひらがなの文字列だった．
つまり，例の一つ目は，`りんご`と`ごりら`を合成した`りんごりら`の後ろに，`らっぱ`を合成したということになる．

`ごりらっぱ`は`ごりら`と`らっぱ`の合成で作られたひらがなの文字列だった．
例の二つ目は，`ごりら`と`らっぱ`を合成した`ごりらっぱ`の前に`りんご`を合成したということになる．

これを三つの文字列の合成としよう．
三つの文字列の合成で，どちらを先に合成したとしても，`りんごりらっぱ`という合成結果は変わらない．

この例から，合成のルールを追加しよう．

2. 三つの文字列を合成するとき，先にどちらを合成しても，結果は変わらない．

## 例: 合成しても変わらない

次に，`ご`というひらがなの文字列との合成を考える．

* `りんご`と`ご`を合成すると，`りんご`になる．
* `ご`と`ごりら`を合成すると，`ごりら`になる．

`ご`と合成しても，ひらがなの文字列(`りんご`，`ごりら`)は変わらなかった．

## ✅合成のルール　その３

ひらがなの文字列は，ひらがな一文字でできた文字列と合成しても，合成結果が元の文字列と変わらなかった．
これを合成のルールに追加する．

3. 合成結果の文字列を変えないような，ひらがな一文字の文字列が存在する．

`ご`のほかにも，`り`，`ら`，`ぱ`などがある．

## 💡圏論の言葉で表す
この合成のルールが圏の定義なので，このルールを満たせば，圏を作ることができる．
それでは，先ほどの例を圏論の言葉で表すことにしよう．

* ひらがなの文字列は **射** と呼ぶ．

今回の例で出てきた，`りんご`，`ご`，`ごりら`，`らっぱ`，`りんごりら`，`ごりらっぱ`，`りんごりらっぱ`，`り`，`ら`，`ぱ`は全て射である．

ひらがなの文字列の合成を **射の合成** という．
射の合成には，ルールが必要だった．

前の文字列の最後の文字と，後ろの文字列の最初の文字が同じとき，前後の文字列を合成することができる．

* ひらがなの文字列の最後の文字を **射のコドメイン** と呼ぶ．
* ひらがなの文字列の最初の文字を **射のドメイン** と呼ぶ．

先ほどの文章を言い換えると，

ルール その１
1. ある射の**コドメイン**と，別の射の**ドメイン**が同じとき，射を合成することができる．

* コドメインやドメインで表されていた，ひらがな一文字のことを **対象** と呼ぶ．
* 射のドメインとコドメインの対象を使って，`対象から対象への射`という．

例えば，`りんご`は`'り'`から`'ご'`への射であり，`ご`は`'ご'`から`'ご'`への射であるという．

* 合成した文字列のことを **合成射** と呼ぶ．

今回の例では，`りんご`と`ごりら`の合成射は`りんごりら`であり，`りんご`と`ご`の合成射は`りんご`である．

ルール　その２

2. 三つの文字列(射)を合成するとき，先にどちらを合成しても，結果は変わらないことを，**結合律**と呼ぶ．

ルール　その３

3. 合成結果の文字列を変えないような，ひらがな一文字の文字列(**恒等射**)が存在することを，**単位律**と呼ぶ．

今回の例では，`り`，`ご`，`ら`，`ぱ`が恒等射である．

---

1. 射に対する合成のルールを決める．
2. そのために，射のドメインとコドメインが必要になり，ここから射の対象が必要になる．
3. 合成は結合律と，単位律を満たす必要があり，単位律から恒等射の存在が必要になる．

* 対象と射を集めたものを圏という．
* 恒等射の存在によって，各対象に少なくとも一つは射が存在することになる．

---

# 行列

行列の合成を考える．
ここでは，行列の乗算を合成ということにする．

ルール　その１

行列Aの列と行列Bの行が等しいとき，合成可能(乗算可能)であり，その結果は行列ABになる．

ルール　その２

行列A, B, Cに対して，合成の順番は関係ない．
つまり，(AB)C = A(BC) = ABCとなる．

ルール　その３

単位行列Iは，合成しても結果に影響を与えない．IA = A, AI = A

射は行列である．
射の合成は行列の乗算である．
射のコドメイン(列)とドメイン(行)を考えると，対象は自然数である．
恒等射は単位行列である．

# 関数

関数の合成を考える．

射は関数である．
射の合成は関数の合成である．
射のコドメイン(返値の型)とドメイン(引数の型)を考えると，対象は型である．
恒等射は引数をそのまま返す関数である．

# 整数

射は整数である．
射の合成は加算である．
射のコドメインとドメインは常に同じであり，対象は一つだけあれば何でもよい．
恒等射は0である．
